{"version":3,"file":"adminReports.bundle.js","mappings":"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","sources":["webpack://order-tip-woo/external var \"jQuery\"","webpack://order-tip-woo/./assets/src/js/admin/admin-reports.js"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = jQuery;","import $ from 'jquery';\nimport '/node_modules/jquery-ui/dist/themes/base/jquery-ui.min.css';\n\n(function($){\n\n    const WOOTAdminReports = {\n\n        init: () => {\n\n            const startYear = wootipar.fod ? wootipar.fod : wootipar.cuy;\n\n            jQuery('#wot-reports-date-from, #wot-reports-date-to').datepicker({\n                dateFormat: 'yy-mm-dd',\n                changeMonth: true,\n                changeYear: true,\n                yearRange: startYear + ':' + wootipar.cuy,\n            });\n\n            jQuery('p.submit').remove();\n\n        },\n\n        getFilteredTipOrders: paged => {\n\n            const dateFrom   = jQuery('#wot-reports-date-from'),\n                dateTo       = jQuery('#wot-reports-date-to'),\n                status       = jQuery('#wot-reports-order-status'),\n                // feeNames = jQuery('#wot-reports-order-fees input:checked'),\n                feeNames     = jQuery('#wot-reports-order-fees'),\n                errorMsg     = jQuery('#woo-order-tip-reports-errors'),\n                containerRes = jQuery('#woo-order-tip-reports-table tbody'),\n                totalRes     = jQuery('#woo-order-tip-reports-table tfoot #woo-order-tip-reports-total'),\n                fromRes      = jQuery('#displaying-from-to #displaying-from'),\n                toRes        = jQuery('#displaying-from-to #displaying-to'),\n                preloader    = jQuery('#woo-order-tip-loading'),\n                errors       = WOOTAdminReports.validateDates();\n\n                \n            if( ! errors ) {\n\n                preloader.show();\n    \n                errorMsg.empty();\n\n                jQuery.ajax({\n                    type: \"POST\",\n                    url: wootipar.aju,\n                    dataType: 'json',\n                    data: ({\n                        action: 'display_orders_list_reports_ajax', \n                        from: dateFrom.val(), \n                        to: dateTo.val(), \n                        feeNames: feeNames.val(),\n                        status: status.val(), \n                        paged: paged,\n                        security: wootipar.ajn\n                    }),\n                    success: function(data) {\n    \n                        if( 'error' === data.status ) {\n                            \n                            jQuery.each( data.errors, function(i, err) {\n                                errormsg.append( '<p>' + err + '</p>' );\n                            });\n\n                        } else {\n\n                            fromRes.text( data.after_date );\n                            toRes.text( data.before_date );\n                            totalRes.empty().text( data.total );\n                            if( 1 == paged ) {\n                                containerRes.empty().html( data.result );\n                            }\n\n                            if( paged > 1 ) {\n                                containerRes.append( data.result );\n                            }\n\n                            WOOTAdminReports.resetRowsData();\n\n                            if( 100 === data.order_ids_count ) {\n                                WOOTAdminReports.getFilteredTipOrders( paged + 1 );\n                            } else {\n                                preloader.hide();\n                            }\n\n                        }\n    \n                    },\n                    error: function( xhr, status, error ) {\n                        errormsg.append( '<p>' + error + '</p>' );\n                        WOOTAdminReports.resetRowsData();\n                        preloader.hide();\n                    }\n                });\n    \n            }\n\n        },\n\n        resetRowsData: () => {\n\n            const table = jQuery('#woo-order-tip-reports-table');\n\n            if( table.find('tbody tr').length ) {\n\n                let total = 0;\n                    \n                table.find('tbody tr').each(function(idx, row){\n                    jQuery(row).find('td.row-count').text( idx + 1 );\n                    const value = jQuery(row).find('td.order-value').attr('data-value');\n                    if( value ) {\n                        total += parseFloat( value );\n                    }\n                });\n\n                jQuery('#woo-order-tip-reports-total').text( total.toFixed(2) );\n\n            }\n\n        },\n\n        onFiltersChange: () => {\n\n            const dateFrom = jQuery('#wot-reports-date-from'),\n                dateTo     = jQuery('#wot-reports-date-to'),\n                // feeNames = jQuery('#wot-reports-order-fees input:checked'),\n                feeNames   = jQuery('#wot-reports-order-fees'),\n                expButton  = jQuery('#wot-export-csv'),\n                errors     = WOOTAdminReports.validateDates();\n    \n            if( ! errors ) {\n\n                let url = wootipar.exn;\n\n                url = url.replace( 'fromDate', dateFrom.val() );\n                url = url.replace( 'toDate', dateTo.val() );\n                url = url.replace( 'Fees', feeNames.val().join(',') );\n\n                expButton.removeAttr('disabled').attr('href', url);\n\n            } else {\n\n                expButton.attr('disabled', 'disabled').attr('href', '#!');\n\n            }\n\n        },\n\n        validateDates: () => {\n        \n            const dateFrom = jQuery('#wot-reports-date-from'),\n                  dateTo   = jQuery('#wot-reports-date-to');\n            \n            let errors= 0;\n\n            if( ! dateFrom.val() ) {\n                dateFrom.css('border', '1px solid red').trigger('focus');\n                errors = 1;\n                return errors;\n            } else {\n                dateFrom.css('border', '1px solid #7e8993');\n                errors = 0;\n            }\n\n            if( ! dateTo.val() ) {\n                dateTo.css('border', '1px solid red').trigger('focus');\n                errors = 1;\n                return errors;\n            } else {\n                dateTo.css('border', '1px solid #7e8993');\n                errors = 0;\n            }\n\n            return errors;\n\n        },\n        selectAllOrders: trigger => {\n\n            jQuery('#woo-order-tip-reports-table input.select-order, #woo-order-tip-reports-table input.select-all').prop('checked', trigger.prop('checked'));\n\n        },\n        onExportCsvClick: trigger => {\n\n            if( jQuery('#woo-order-tip-reports-table input.select-order:checked').length <= 0 ) {\n                alert('Please select at least one order to export');\n                return false;\n            }\n\n            const errorMsg = jQuery('#woo-order-tip-reports-errors'),\n                  preloader    = jQuery('#woo-order-tip-loading');\n\n            let orders = [];\n\n            jQuery('#woo-order-tip-reports-table input.select-order:checked').each(function(idx, order){\n                let orderRow = jQuery(order).parents('tr');\n                orders.push( {\n                    orderId: orderRow.find('td.order-id').attr('data-value'),\n                    feeName: orderRow.find('td.fee-type').attr('data-value'),\n                    feeValue: orderRow.find('td.order-value').attr('data-value'),\n                    orderDate: orderRow.find('td.order-date').attr('data-value'),\n                } );\n            });\n\n            preloader.show();\n    \n            errorMsg.empty();\n\n            jQuery.ajax({\n                type: \"POST\",\n                url: wootipar.aju,\n                dataType: 'json',\n                data: ({\n                    action: 'export_tips_to_csv_ajax', \n                    data: orders,\n                    security: wootipar.erc\n                }),\n                success: function(data) {\n\n                    preloader.hide();\n\n                    if( data.errors.length ) {\n                        \n                        jQuery.each( data.errors, function(i, err) {\n                            errorMsg.append( '<p>' + err + '</p>' );\n                        });\n\n                        return false;\n\n                    }\n\n                    if( data.fileUrl ) {\n                        window.open(data.fileUrl);\n                    }\n\n                    if( data.filePath ) {\n\n                        setTimeout(() => {\n\n                            jQuery.ajax({\n                                type: \"POST\",\n                                url: wootipar.aju,\n                                dataType: 'json',\n                                data: ({\n                                    action: 'delete_exported_csv_file_ajax', \n                                    filePath: data.filePath,\n                                    security: wootipar.def\n                                }),\n                                success: function(data) {\n\n                                }\n                            });\n\n                        }, 500);\n\n                    }\n\n                },\n                error: function( xhr, status, error ) {\n                    errormsg.append( '<p>' + error + '</p>' );\n                    preloader.hide();\n                }\n            });\n\n        }\n\n    };\n\n    jQuery(function(){\n\n        WOOTAdminReports.init();\n\n        jQuery('body').on('click', '#wot-set-filters', function(evt){\n            evt.preventDefault();\n            WOOTAdminReports.getFilteredTipOrders(1);\n        });\n\n        jQuery('body').on('change', '#wot-reports-date-from, #wot-reports-date-to, #wot-reports-order-fees', function(evt){\n            WOOTAdminReports.onFiltersChange();\n        });\n\n        jQuery('body').on('click', '#woo-order-tip-reports-table input.select-all', function(evt){\n            WOOTAdminReports.selectAllOrders( jQuery(this) );\n        });\n\n        jQuery('body').on('click', '#wot-export-csv', function(evt){\n            evt.preventDefault();\n            WOOTAdminReports.onExportCsvClick( jQuery(this) );\n        });\n\n    });\n\n})(jQuery);"],"names":["jQuery","WOOTAdminReports","init","startYear","wootipar","fod","cuy","datepicker","dateFormat","changeMonth","changeYear","yearRange","remove","getFilteredTipOrders","paged","dateFrom","dateTo","status","feeNames","errorMsg","containerRes","totalRes","fromRes","toRes","preloader","validateDates","show","empty","ajax","type","url","aju","dataType","data","action","from","val","to","security","ajn","success","each","errors","i","err","errormsg","append","text","after_date","before_date","total","html","result","resetRowsData","order_ids_count","hide","error","xhr","table","find","length","idx","row","value","attr","parseFloat","toFixed","onFiltersChange","expButton","exn","replace","join","removeAttr","css","trigger","selectAllOrders","prop","onExportCsvClick","alert","orders","order","orderRow","parents","push","orderId","feeName","feeValue","orderDate","erc","fileUrl","window","open","filePath","setTimeout","def","on","evt","preventDefault","this"],"sourceRoot":""}