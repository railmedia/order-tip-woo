{"version":3,"file":"adminReports.bundle.js","mappings":"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","sources":["webpack://order-tip-woo/external var \"jQuery\"","webpack://order-tip-woo/./assets/src/js/admin/admin-reports.js"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = jQuery;","import $ from 'jquery';\nimport '/node_modules/jquery-ui/dist/themes/base/jquery-ui.min.css';\n\n(function($){\n\n    const WOOTAdminReports = {\n\n        init: () => {\n\n            const startYear = wootipar.fod ? wootipar.fod : wootipar.cuy;\n\n            jQuery('#wot-reports-date-from, #wot-reports-date-to').datepicker({\n                dateFormat: 'yy-mm-dd',\n                changeMonth: true,\n                changeYear: true,\n                yearRange: startYear + ':' + wootipar.cuy,\n            });\n\n            jQuery('p.submit').remove();\n\n        },\n\n        getRowData: row => {\n\n            const lastRow = jQuery('#woo-order-tip-reports-table tbody tr:last-child').index();\n\n            return (\n                `<tr data-orderid=\"${ row['orderId'] }\">\n                    <td style=\"width: 30px;\">\n                        <input class=\"select-order\" type=\"checkbox\" />\n                    </td>\n                    <td class=\"row-count\" data-value=\"${ lastRow + 1 }\">\n                        ${ lastRow + 1 }\n                    </td>\n                    <td class=\"order-id\" data-value=\"${ row['orderId'] }\">\n                        <a href=\"${ row['orderLink'] }\" target=\"_blank\" rel=\"noopener noreferrer\">${ row['orderId'] }</a>\n                    </td>\n                    <td class=\"order-status-col\" data-value=\"${ row['orderStatus'] }\">\n                        ${ row['orderStatus'] }\n                    </td>\n                    <td class=\"customer-name\" data-value=\"${ row['customer'] }\">\n                        ${ row['customer'] }\n                    </td>\n                    <td class=\"fee-type\" data-value=\"${ row['feeType'] }\">\n                        ${ row['feeType'] }\n                    </td>\n                    <td class=\"order-value\" data-value=\"${ row['feeValue'] }\">\n                        ${ row['feePrice'] }\n                    </td>\n                    <td class=\"order-date\" data-value=\"${ row['orderDate'] }\">\n                        ${ row['orderDate'] }\n                    </td>\n                </tr>`\n            );\n\n        },\n\n        getFilteredTipOrders: paged => {\n\n            const dateFrom   = jQuery('#wot-reports-date-from'),\n                dateTo       = jQuery('#wot-reports-date-to'),\n                status       = jQuery('#wot-reports-order-status'),\n                // feeNames = jQuery('#wot-reports-order-fees input:checked'),\n                feeNames     = jQuery('#wot-reports-order-fees'),\n                errorMsg     = jQuery('#woo-order-tip-reports-errors'),\n                containerRes = jQuery('#woo-order-tip-reports-table tbody'),\n                totalRes     = jQuery('#woo-order-tip-reports-table tfoot #woo-order-tip-reports-total'),\n                fromRes      = jQuery('#displaying-from-to #displaying-from'),\n                toRes        = jQuery('#displaying-from-to #displaying-to'),\n                preloader    = jQuery('#woo-order-tip-loading'),\n                errors       = WOOTAdminReports.validateDates();\n\n                \n            if( ! errors ) {\n\n                preloader.show();\n    \n                errorMsg.empty();\n\n                jQuery.ajax({\n                    type: \"POST\",\n                    url: wootipar.aju,\n                    dataType: 'json',\n                    data: ({\n                        action: 'display_orders_list_reports_ajax', \n                        from: dateFrom.val(), \n                        to: dateTo.val(), \n                        feeNames: feeNames.val(),\n                        status: status.val(), \n                        paged: paged,\n                        security: wootipar.ajn\n                    }),\n                    success: function(data) {\n    \n                        if( 'error' === data.status ) {\n                            \n                            jQuery.each( data.errors, function(i, err) {\n                                errormsg.append( '<p>' + err + '</p>' );\n                            });\n\n                        } else {\n\n                            fromRes.text( data.after_date );\n                            toRes.text( data.before_date );\n                            totalRes.empty().text( data.total );\n                            if( 1 == paged ) {\n                                containerRes.empty().html( data.result );\n                            }\n\n                            if( paged > 1 ) {\n\n                                // containerRes.append( data.result );\n\n                                console.log(data.result);\n                                for( const key in data.result ) {\n\n                                    if( ! jQuery(`#woo-order-tip-reports-table tbody tr[data-orderid=\"${ data.result[key]['orderId'] }\"]`).length ) {\n                                        const rowData = WOOTAdminReports.getRowData( data.result[key] );\n                                        containerRes.append( rowData );\n                                    }\n                                    // containerRes.append( data.result[key] );\n                                }\n                            }\n\n                            WOOTAdminReports.resetRowsData();\n\n                            if( 100 === data.order_ids_count ) {\n                                WOOTAdminReports.getFilteredTipOrders( paged + 1 );\n                            } else {\n                                preloader.hide();\n                            }\n\n                        }\n    \n                    },\n                    error: function( xhr, status, error ) {\n                        errormsg.append( '<p>' + error + '</p>' );\n                        WOOTAdminReports.resetRowsData();\n                        preloader.hide();\n                    }\n                });\n    \n            }\n\n        },\n\n        resetRowsData: () => {\n\n            const table = jQuery('#woo-order-tip-reports-table');\n\n            if( table.find('tbody tr').length ) {\n\n                let total = 0;\n                    \n                table.find('tbody tr').each(function(idx, row){\n                    jQuery(row).find('td.row-count').text( idx + 1 );\n                    const value = jQuery(row).find('td.order-value').attr('data-value');\n                    if( value ) {\n                        total += parseFloat( value );\n                    }\n                });\n\n                jQuery('#woo-order-tip-reports-total').text( total.toFixed(2) );\n\n            }\n\n        },\n\n        onFiltersChange: () => {\n\n            const dateFrom = jQuery('#wot-reports-date-from'),\n                dateTo     = jQuery('#wot-reports-date-to'),\n                // feeNames = jQuery('#wot-reports-order-fees input:checked'),\n                feeNames   = jQuery('#wot-reports-order-fees'),\n                expButton  = jQuery('#wot-export-csv'),\n                errors     = WOOTAdminReports.validateDates();\n    \n            if( ! errors ) {\n\n                let url = wootipar.exn;\n\n                url = url.replace( 'fromDate', dateFrom.val() );\n                url = url.replace( 'toDate', dateTo.val() );\n                url = url.replace( 'Fees', feeNames.val().join(',') );\n\n                expButton.removeAttr('disabled').attr('href', url);\n\n            } else {\n\n                expButton.attr('disabled', 'disabled').attr('href', '#!');\n\n            }\n\n        },\n\n        validateDates: () => {\n        \n            const dateFrom = jQuery('#wot-reports-date-from'),\n                  dateTo   = jQuery('#wot-reports-date-to');\n            \n            let errors= 0;\n\n            if( ! dateFrom.val() ) {\n                dateFrom.css('border', '1px solid red').trigger('focus');\n                errors = 1;\n                return errors;\n            } else {\n                dateFrom.css('border', '1px solid #7e8993');\n                errors = 0;\n            }\n\n            if( ! dateTo.val() ) {\n                dateTo.css('border', '1px solid red').trigger('focus');\n                errors = 1;\n                return errors;\n            } else {\n                dateTo.css('border', '1px solid #7e8993');\n                errors = 0;\n            }\n\n            return errors;\n\n        },\n        selectAllOrders: trigger => {\n\n            jQuery('#woo-order-tip-reports-table input.select-order, #woo-order-tip-reports-table input.select-all').prop('checked', trigger.prop('checked'));\n\n        },\n        onExportCsvClick: trigger => {\n\n            if( jQuery('#woo-order-tip-reports-table input.select-order:checked').length <= 0 ) {\n                alert('Please select at least one order to export');\n                return false;\n            }\n\n            const errorMsg = jQuery('#woo-order-tip-reports-errors'),\n                  preloader    = jQuery('#woo-order-tip-loading');\n\n            let orders = [];\n\n            jQuery('#woo-order-tip-reports-table input.select-order:checked').each(function(idx, order){\n                let orderRow = jQuery(order).parents('tr');\n                orders.push( {\n                    orderId: orderRow.find('td.order-id').attr('data-value'),\n                    feeName: orderRow.find('td.fee-type').attr('data-value'),\n                    feeValue: orderRow.find('td.order-value').attr('data-value'),\n                    orderDate: orderRow.find('td.order-date').attr('data-value'),\n                } );\n            });\n\n            preloader.show();\n    \n            errorMsg.empty();\n\n            jQuery.ajax({\n                type: \"POST\",\n                url: wootipar.aju,\n                dataType: 'json',\n                data: ({\n                    action: 'export_tips_to_csv_ajax', \n                    data: orders,\n                    security: wootipar.erc\n                }),\n                success: function(data) {\n\n                    preloader.hide();\n\n                    if( data.errors.length ) {\n                        \n                        jQuery.each( data.errors, function(i, err) {\n                            errorMsg.append( '<p>' + err + '</p>' );\n                        });\n\n                        return false;\n\n                    }\n\n                    if( data.fileUrl ) {\n                        window.open(data.fileUrl);\n                    }\n\n                    if( data.filePath ) {\n\n                        setTimeout(() => {\n\n                            jQuery.ajax({\n                                type: \"POST\",\n                                url: wootipar.aju,\n                                dataType: 'json',\n                                data: ({\n                                    action: 'delete_exported_csv_file_ajax', \n                                    filePath: data.filePath,\n                                    security: wootipar.def\n                                }),\n                                success: function(data) {\n\n                                }\n                            });\n\n                        }, 500);\n\n                    }\n\n                },\n                error: function( xhr, status, error ) {\n                    errormsg.append( '<p>' + error + '</p>' );\n                    preloader.hide();\n                }\n            });\n\n        }\n\n    };\n\n    jQuery(function(){\n\n        WOOTAdminReports.init();\n\n        jQuery('body').on('click', '#wot-set-filters', function(evt){\n            evt.preventDefault();\n            WOOTAdminReports.getFilteredTipOrders(1);\n        });\n\n        jQuery('body').on('change', '#wot-reports-date-from, #wot-reports-date-to, #wot-reports-order-fees', function(evt){\n            WOOTAdminReports.onFiltersChange();\n        });\n\n        jQuery('body').on('click', '#woo-order-tip-reports-table input.select-all', function(evt){\n            WOOTAdminReports.selectAllOrders( jQuery(this) );\n        });\n\n        jQuery('body').on('click', '#wot-export-csv', function(evt){\n            evt.preventDefault();\n            WOOTAdminReports.onExportCsvClick( jQuery(this) );\n        });\n\n    });\n\n})(jQuery);"],"names":["jQuery","WOOTAdminReports","init","startYear","wootipar","fod","cuy","datepicker","dateFormat","changeMonth","changeYear","yearRange","remove","getRowData","row","lastRow","index","getFilteredTipOrders","paged","dateFrom","dateTo","status","feeNames","errorMsg","containerRes","totalRes","fromRes","toRes","preloader","validateDates","show","empty","ajax","type","url","aju","dataType","data","action","from","val","to","security","ajn","success","each","errors","i","err","errormsg","append","text","after_date","before_date","total","html","result","console","log","key","length","rowData","resetRowsData","order_ids_count","hide","error","xhr","table","find","idx","value","attr","parseFloat","toFixed","onFiltersChange","expButton","exn","replace","join","removeAttr","css","trigger","selectAllOrders","prop","onExportCsvClick","alert","orders","order","orderRow","parents","push","orderId","feeName","feeValue","orderDate","erc","fileUrl","window","open","filePath","setTimeout","def","on","evt","preventDefault","this"],"sourceRoot":""}