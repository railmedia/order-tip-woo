(()=>{"use strict";(()=>{jQuery;!function(){const e={init:()=>{const e=wootipar.fod?wootipar.fod:wootipar.cuy;jQuery("#wot-reports-date-from, #wot-reports-date-to").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:e+":"+wootipar.cuy}),jQuery("p.submit").remove()},getRowData:e=>{const t=jQuery("#woo-order-tip-reports-table tbody tr:last-child").index();return`<tr data-orderid="${e.orderId}">\n                    <td style="width: 30px;">\n                        <input class="select-order" type="checkbox" />\n                    </td>\n                    <td class="row-count" data-value="${t+1}">\n                        ${t+1}\n                    </td>\n                    <td class="order-id" data-value="${e.orderId}">\n                        <a href="${e.orderLink}" target="_blank" rel="noopener noreferrer">${e.orderId}</a>\n                    </td>\n                    <td class="order-status-col" data-value="${e.orderStatus}">\n                        ${e.orderStatus}\n                    </td>\n                    <td class="customer-name" data-value="${e.customer}">\n                        ${e.customer}\n                    </td>\n                    <td class="fee-type" data-value="${e.feeType}">\n                        ${e.feeType}\n                    </td>\n                    <td class="order-value" data-value="${e.feeValue}">\n                        ${e.feePrice}\n                    </td>\n                    <td class="order-date" data-value="${e.orderDate}">\n                        ${e.orderDate}\n                    </td>\n                </tr>`},getFilteredTipOrders:t=>{const r=jQuery("#wot-reports-date-from"),o=jQuery("#wot-reports-date-to"),a=jQuery("#wot-reports-order-status"),d=jQuery("#wot-reports-order-fees"),s=jQuery("#woo-order-tip-reports-errors"),n=jQuery("#woo-order-tip-reports-table tbody"),i=jQuery("#woo-order-tip-reports-table tfoot #woo-order-tip-reports-total"),l=jQuery("#displaying-from-to #displaying-from"),p=jQuery("#displaying-from-to #displaying-to"),u=jQuery("#woo-order-tip-loading");e.validateDates()||(u.show(),s.empty(),jQuery.ajax({type:"POST",url:wootipar.aju,dataType:"json",data:{action:"display_orders_list_reports_ajax",from:r.val(),to:o.val(),feeNames:d.val(),status:a.val(),paged:t,security:wootipar.ajn},success:function(r){if("error"===r.status)jQuery.each(r.errors,(function(e,t){errormsg.append("<p>"+t+"</p>")}));else{if(l.text(r.after_date),p.text(r.before_date),i.empty().text(r.total),1==t&&n.empty().html(r.result),t>1){console.log(r.result);for(const t in r.result)if(!jQuery(`#woo-order-tip-reports-table tbody tr[data-orderid="${r.result[t].orderId}"]`).length){const o=e.getRowData(r.result[t]);n.append(o)}}e.resetRowsData(),100===r.order_ids_count?e.getFilteredTipOrders(t+1):u.hide()}},error:function(t,r,o){errormsg.append("<p>"+o+"</p>"),e.resetRowsData(),u.hide()}}))},resetRowsData:()=>{const e=jQuery("#woo-order-tip-reports-table");if(e.find("tbody tr").length){let t=0;e.find("tbody tr").each((function(e,r){jQuery(r).find("td.row-count").text(e+1);const o=jQuery(r).find("td.order-value").attr("data-value");o&&(t+=parseFloat(o))})),jQuery("#woo-order-tip-reports-total").text(t.toFixed(2))}},onFiltersChange:()=>{const t=jQuery("#wot-reports-date-from"),r=jQuery("#wot-reports-date-to"),o=jQuery("#wot-reports-order-fees"),a=jQuery("#wot-export-csv");if(e.validateDates())a.attr("disabled","disabled").attr("href","#!");else{let e=wootipar.exn;e=e.replace("fromDate",t.val()),e=e.replace("toDate",r.val()),e=e.replace("Fees",o.val().join(",")),a.removeAttr("disabled").attr("href",e)}},validateDates:()=>{const e=jQuery("#wot-reports-date-from"),t=jQuery("#wot-reports-date-to");let r=0;return e.val()?(e.css("border","1px solid #7e8993"),r=0,t.val()?(t.css("border","1px solid #7e8993"),r=0,r):(t.css("border","1px solid red").trigger("focus"),r=1,r)):(e.css("border","1px solid red").trigger("focus"),r=1,r)},selectAllOrders:e=>{jQuery("#woo-order-tip-reports-table input.select-order, #woo-order-tip-reports-table input.select-all").prop("checked",e.prop("checked"))},onExportCsvClick:e=>{if(jQuery("#woo-order-tip-reports-table input.select-order:checked").length<=0)return alert("Please select at least one order to export"),!1;const t=jQuery("#woo-order-tip-reports-errors"),r=jQuery("#woo-order-tip-loading");let o=[];jQuery("#woo-order-tip-reports-table input.select-order:checked").each((function(e,t){let r=jQuery(t).parents("tr");o.push({orderId:r.find("td.order-id").attr("data-value"),feeName:r.find("td.fee-type").attr("data-value"),feeValue:r.find("td.order-value").attr("data-value"),orderDate:r.find("td.order-date").attr("data-value")})})),r.show(),t.empty(),jQuery.ajax({type:"POST",url:wootipar.aju,dataType:"json",data:{action:"export_tips_to_csv_ajax",data:o,security:wootipar.erc},success:function(e){if(r.hide(),e.errors.length)return jQuery.each(e.errors,(function(e,r){t.append("<p>"+r+"</p>")})),!1;e.fileUrl&&window.open(e.fileUrl),e.filePath&&setTimeout((()=>{jQuery.ajax({type:"POST",url:wootipar.aju,dataType:"json",data:{action:"delete_exported_csv_file_ajax",filePath:e.filePath,security:wootipar.def},success:function(e){}})}),500)},error:function(e,t,o){errormsg.append("<p>"+o+"</p>"),r.hide()}})}};jQuery((function(){e.init(),jQuery("body").on("click","#wot-set-filters",(function(t){t.preventDefault(),e.getFilteredTipOrders(1)})),jQuery("body").on("change","#wot-reports-date-from, #wot-reports-date-to, #wot-reports-order-fees",(function(t){e.onFiltersChange()})),jQuery("body").on("click","#woo-order-tip-reports-table input.select-all",(function(t){e.selectAllOrders(jQuery(this))})),jQuery("body").on("click","#wot-export-csv",(function(t){t.preventDefault(),e.onExportCsvClick(jQuery(this))}))}))}(jQuery)})()})();
//# sourceMappingURL=adminReports.bundle.js.map