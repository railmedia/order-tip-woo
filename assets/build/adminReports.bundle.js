(()=>{"use strict";(()=>{jQuery;!function(){const e={init:()=>{const e=wootipar.fod?wootipar.fod:wootipar.cuy;jQuery("#wot-reports-date-from, #wot-reports-date-to").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:e+":"+wootipar.cuy}),jQuery("p.submit").remove()},getFilteredTipOrders:r=>{const t=jQuery("#wot-reports-date-from"),o=jQuery("#wot-reports-date-to"),a=jQuery("#wot-reports-order-status"),s=jQuery("#wot-reports-order-fees"),d=jQuery("#woo-order-tip-reports-errors"),i=jQuery("#woo-order-tip-reports-table tbody"),p=jQuery("#woo-order-tip-reports-table tfoot #woo-order-tip-reports-total"),l=jQuery("#displaying-from-to #displaying-from"),n=jQuery("#displaying-from-to #displaying-to"),u=jQuery("#woo-order-tip-loading");e.validateDates()||(u.show(),d.empty(),jQuery.ajax({type:"POST",url:wootipar.aju,dataType:"json",data:{action:"display_orders_list_reports_ajax",from:t.val(),to:o.val(),feeNames:s.val(),status:a.val(),paged:r,security:wootipar.ajn},success:function(t){"error"===t.status?jQuery.each(t.errors,(function(e,r){errormsg.append("<p>"+r+"</p>")})):(l.text(t.after_date),n.text(t.before_date),p.empty().text(t.total),1==r&&i.empty().html(t.result),r>1&&i.append(t.result),e.resetRowsData(),100===t.order_ids_count?e.getFilteredTipOrders(r+1):u.hide())},error:function(r,t,o){errormsg.append("<p>"+o+"</p>"),e.resetRowsData(),u.hide()}}))},resetRowsData:()=>{const e=jQuery("#woo-order-tip-reports-table");if(e.find("tbody tr").length){let r=0;e.find("tbody tr").each((function(e,t){jQuery(t).find("td.row-count").text(e+1);const o=jQuery(t).find("td.order-value").attr("data-value");o&&(r+=parseFloat(o))})),jQuery("#woo-order-tip-reports-total").text(r.toFixed(2))}},onFiltersChange:()=>{const r=jQuery("#wot-reports-date-from"),t=jQuery("#wot-reports-date-to"),o=jQuery("#wot-reports-order-fees"),a=jQuery("#wot-export-csv");if(e.validateDates())a.attr("disabled","disabled").attr("href","#!");else{let e=wootipar.exn;e=e.replace("fromDate",r.val()),e=e.replace("toDate",t.val()),e=e.replace("Fees",o.val().join(",")),a.removeAttr("disabled").attr("href",e)}},validateDates:()=>{const e=jQuery("#wot-reports-date-from"),r=jQuery("#wot-reports-date-to");let t=0;return e.val()?(e.css("border","1px solid #7e8993"),t=0,r.val()?(r.css("border","1px solid #7e8993"),t=0,t):(r.css("border","1px solid red").trigger("focus"),t=1,t)):(e.css("border","1px solid red").trigger("focus"),t=1,t)},selectAllOrders:e=>{jQuery("#woo-order-tip-reports-table input.select-order, #woo-order-tip-reports-table input.select-all").prop("checked",e.prop("checked"))},onExportCsvClick:e=>{if(jQuery("#woo-order-tip-reports-table input.select-order:checked").length<=0)return alert("Please select at least one order to export"),!1;const r=jQuery("#woo-order-tip-reports-errors"),t=jQuery("#woo-order-tip-loading");let o=[];jQuery("#woo-order-tip-reports-table input.select-order:checked").each((function(e,r){let t=jQuery(r).parents("tr");o.push({orderId:t.find("td.order-id").attr("data-value"),feeName:t.find("td.fee-type").attr("data-value"),feeValue:t.find("td.order-value").attr("data-value"),orderDate:t.find("td.order-date").attr("data-value")})})),t.show(),r.empty(),jQuery.ajax({type:"POST",url:wootipar.aju,dataType:"json",data:{action:"export_tips_to_csv_ajax",data:o,security:wootipar.erc},success:function(e){if(t.hide(),e.errors.length)return jQuery.each(e.errors,(function(e,t){r.append("<p>"+t+"</p>")})),!1;e.fileUrl&&window.open(e.fileUrl),e.filePath&&setTimeout((()=>{jQuery.ajax({type:"POST",url:wootipar.aju,dataType:"json",data:{action:"delete_exported_csv_file_ajax",filePath:e.filePath,security:wootipar.def},success:function(e){}})}),500)},error:function(e,r,o){errormsg.append("<p>"+o+"</p>"),t.hide()}})}};jQuery((function(){e.init(),jQuery("body").on("click","#wot-set-filters",(function(r){r.preventDefault(),e.getFilteredTipOrders(1)})),jQuery("body").on("change","#wot-reports-date-from, #wot-reports-date-to, #wot-reports-order-fees",(function(r){e.onFiltersChange()})),jQuery("body").on("click","#woo-order-tip-reports-table input.select-all",(function(r){e.selectAllOrders(jQuery(this))})),jQuery("body").on("click","#wot-export-csv",(function(r){r.preventDefault(),e.onExportCsvClick(jQuery(this))}))}))}(jQuery)})()})();
//# sourceMappingURL=adminReports.bundle.js.map